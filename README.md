# Finding Twitter Targeting_Users Application

Twitterのターゲットユーザーを提案してくれるアプリです。

## 何ができる？

Twitterで自社製品を広告したいとき、どんなユーザーにツイートを届ければよいでしょうか？
あるキーワードを含むツイートに「いいね」したユーザーが他によく似たツイートに「いいね」していれば、そのユーザーは、そのキーワードに強い関心を持っていると仮定してよいのではないでしょうか。
そこで以下のようなレポートを返すアプリを作ってみました。

```　
=======================================
〇〇様が入力されたキーワードと、選択されたツイートはこちらです。

■ キーワード：udemy

■ ツイート：
「udemy今日だけセールやってる！JSの基礎から学び直したい！ #駆け出しエンジニアと繋がりたい」

---------------------------------------

上記ツイートに「いいね」したターゲットユーザー候補を表示します。

■ ユーザー：@hogehoge

■ 上記ユーザーがいいねした類似度の高いツイート：
「GAS入門講座終了！ひと月かかったけどようやく仕事で使えそう。#udemy #JavaScript」

■ 類似度スコア（0〜1）：0.87
=======================================
処理時間は38.34秒でした。
```

いい感じのターゲットユーザーが見つかれば、あとはフォローするなり、そのユーザーの属性から類似する層に向けてツイッター広告を打つなり、ツイートの文面を研究するなり、アクションが取れそうです。
類似したユーザーは「興味関心、行動、エンゲージメントが既存の顧客と似ている」ため、広告キャンペーンのターゲットとして有効と言われています。
あなたが上司にTwitter広告のターゲティングを頼まれたら、ぜひ使ってみてください。


## アプリの設計

アプリの処理は大きく分けて二つのパートに分かれます。
一つはflaskによるwebアプリケーションの処理で、もう一つは、pythonによるバッチ処理です。バッチ処理において、機械学習モデル（BertJapaneseTokenizer）を利用します。

以下の文章中の①〜⑰は、flaskのディレクトリごとの処理を表示しています。⑱〜㉛はpythonのバッチ処理を示しています。
※文中の丸数字は画像中の丸数字に対応しています。

- ルートディレクトリ（トップページ）
    - ①トップページ表示
    - ②クライアントが「Start App」ボタンが押す
        - ③Twitterに開発者のapi_key、api_key_secretを送る
        - ④Twitterからリクエストトークンを受け取る
        - ⑤Twitter連携アプリ認証URL表示

-  request_tokenディレクトリ（連携アプリ認証ページ）
    -  ⑥クライアントがログイン入力&「Authorize App」ボタンが押す
        - ⑦Twitterにリクエストトークンを渡す
        - ⑧Twitterからaccess_token、認証コード（verifier）を受け取る

- callbackディレクトリ
    - access_token、認証コードでOAuth認証を行う

![アプリ設計図 (13)](https://user-images.githubusercontent.com/31781305/141421466-d071d184-8027-4037-8bb9-19b0979841ba.png)

- get_keywordディレクトリ（キーワード入力ページ）
    - ⑨キーワード入力ページ表示

- post_tweetsディレクトリ（検索結果ページ）
    - ⑩クライアントがキーワード、アドレス、名前を入力して「Send」ボタンを押す
        - キーワード、アドレス、名前をsessionに保存
    - ⑪Twitterにキーワードでツイート検索をかける
    - ⑫ツイートデータを受け取る
    - ⑬データ整形
    - ⑭検索結果ページ表示

![アプリ設計図 (9)](https://user-images.githubusercontent.com/31781305/141421402-25f32b2a-9c8b-44b3-abc3-3018503b9f5c.png)

- display_informationディレクトリ
    - ⑮クライアントがツイートを選択する
        - ツイートIDを保存
    - ⑯ファイルにクライアントの入力情報とツイート情報を書込み（※Twitterログイン情報は含みません）
    - ⑰お知らせページ表示

![アプリ設計図 (10)](https://user-images.githubusercontent.com/31781305/141421405-ec3a8cf1-e5ff-4f40-9292-fc90374da050.png)

flaskの処理はここまでで終了です。ここからはpythonのバッチ処理になります。

- バッチ処理
    - ⑱データ読取り（※スケジューラ設定がある場合は定期実行）
    - ⑲読取り後にファイルをクリア
    - ⑳クライアントごとにオブジェクトを作成
        - データ保存
    - ㉑TwitterにツイートIDで検索をかける
    - ㉒ツイートに「いいねしたユーザー」の情報を取得
    - ㉓TwitterにユーザーIDで検索をかける
    - ㉔ユーザーごとに「いいねしたツイート」100件を取得

![アプリ設計図 (11)](https://user-images.githubusercontent.com/31781305/141421406-81517453-9fe5-4b76-9c4e-4aae019ea38e.png)

- ㉕ツイートを選定
        - キーワードを含むもの
    - ㉖ツイートを文単位でセパレート
    - ㉗モデルに文を渡す
        - transformersのBertJapaneseTokenizerを使用
    - ㉘ベクトル表現を取得
    - ㉙ベクトル間の類似度を計算
        - クライアントの選んだツイートとそれに関連するツイート間の類似度
    - ㉚計算結果をGmailで送信
    - ㉛クライアントにメールが届く

![アプリ設計図 (12)](https://user-images.githubusercontent.com/31781305/141421408-693d7ebe-5e6e-45e7-b356-28c1a113bbe0.png)

